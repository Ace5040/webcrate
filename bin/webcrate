#!/bin/bash
SCRIPT=`realpath $0`
SCRIPTPATH=`dirname $SCRIPT`
cd $SCRIPTPATH/..
WEBCRATE_PWD=$(pwd)
source ./bin/commands/configure.inc
if [[ ! -f ".env" ]]; then
	Configure
fi
if [[ ! -f ".env" ]]; then
	exit 1
fi
source ./.env
source ./images.default
source ./bin/includes/functions.inc
source ./bin/commands/start.inc
source ./bin/commands/stop.inc
source ./bin/commands/restart.inc
source ./bin/commands/build.inc
source ./bin/commands/pull.inc
source ./bin/commands/push.inc
source ./bin/commands/update.inc
source ./bin/commands/log.inc
source ./bin/commands/dock.inc
source ./bin/commands/backup.inc
source ./bin/commands/help.inc
source ./bin/commands/localegen.inc

set -o errexit -o pipefail -o noclobber -o nounset
getopt --test > /dev/null && true
if [[ $? -ne 4 ]]; then
	echo 'getopt --test failed in this environment'
	exit 1
fi

ALLOWED_SERVICES=(\
	nginx\
	utils-pwgen\
	utils-docker\
	core\
	core-gunicorn\
	core-php83\
	core-php81\
	core-php74\
	core-php73\
	core-php56\
	admin\
	dnsmasq\
	stats\
)

COMMAND=$1;
shift;
case $COMMAND in
	start) Start $@;;
	stop) Stop $@;;
	restart) Restart $@;;
	dock) Dock $@;;
	pull) Pull $@;;
	update) Update $@;;
	build) Build $@;;
	push) Push $@;;
	log) Log $@;;
	backup) Backup $@;;
	help) Help $@;;
	configure) Configure $@;;
	localegen) Localegen $@;;
	*) echo "Unknown command: '$COMMAND'. Use 'webcrate help' to get list of commands"
esac

exit 0
